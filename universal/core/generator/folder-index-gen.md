# æ–‡ä»¶å¤¹ç´¢å¼•ç”Ÿæˆå™¨ (Folder Index Generator)

## åŠŸèƒ½

ä¸ºåŒ…å«ä»£ç æ–‡ä»¶çš„æ–‡ä»¶å¤¹ç”Ÿæˆ `FOLDER_INDEX.md`,åˆ—å‡ºæ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶åŠå…¶ Input/Output/Pos ä¿¡æ¯ã€‚

## è¾“å…¥å‚æ•°

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `folderPath` | string | æ–‡ä»¶å¤¹ç»å¯¹è·¯å¾„ |
| `files` | array | æ–‡ä»¶å¤¹å†…æ–‡ä»¶åˆ—è¡¨åŠå…¶åˆ†æç»“æœ |
| `language` | string | è¯­è¨€ä»£ç  (`zh-CN` / `en-US`) |
| `LANG` | object | è¯­è¨€å¯¹è±¡ |

## è¾“å‡º

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| `indexContent` | string | ç”Ÿæˆçš„ FOLDER_INDEX.md å†…å®¹ (Markdownæ ¼å¼) |

## ç´¢å¼•æ¨¡æ¿

### ä¸­æ–‡æ¨¡æ¿ (zh-CN)

```markdown
# {folderName}

ğŸ”„ **è‡ªå¼•ç”¨æé†’**: å½“æ­¤æ–‡ä»¶å¤¹å†…å®¹å˜åŒ–æ—¶,æ›´æ–°æ­¤ç´¢å¼•

## ğŸ“ æ–‡ä»¶å¤¹å®šä½

**Pos**: {folderPos}

**èŒè´£**: {folderResponsibility}

---

## ğŸ“„ æ–‡ä»¶åˆ—è¡¨

### {fileName1}

- **Input**: {input}
- **Output**: {output}
- **Pos**: {pos}

### {fileName2}

- **Input**: {input}
- **Output**: {output}
- **Pos**: {pos}

...

---

## ğŸ”— ä¾èµ–å…³ç³»

### å†…éƒ¨ä¾èµ–

{folderName} å†…çš„æ–‡ä»¶ç›¸äº’ä¾èµ–:

- `{file1}` â†’ `{file2}`, `{file3}`
- `{file2}` â†’ `{file4}`

### å¤–éƒ¨ä¾èµ–

{folderName} ä¾èµ–ä»¥ä¸‹å¤–éƒ¨æ¨¡å—:

- `{externalDep1}`
- `{externalDep2}`

---

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

- **æ–‡ä»¶æ€»æ•°**: {totalFiles}
- **ä¸»è¦è¯­è¨€**: {primaryLanguage}
- **æ¶æ„å±‚çº§**: {layers}

---

*æ­¤ç´¢å¼•ç”± project-multilevel-index è‡ªåŠ¨ç”Ÿæˆ*
```

---

### è‹±æ–‡æ¨¡æ¿ (en-US)

```markdown
# {folderName}

ğŸ”„ **Self-Reference Reminder**: Update this index when folder contents change

## ğŸ“ Folder Position

**Pos**: {folderPos}

**Responsibility**: {folderResponsibility}

---

## ğŸ“„ File List

### {fileName1}

- **Input**: {input}
- **Output**: {output}
- **Pos**: {pos}

### {fileName2}

- **Input**: {input}
- **Output**: {output}
- **Pos**: {pos}

...

---

## ğŸ”— Dependencies

### Internal Dependencies

Files within {folderName} depend on each other:

- `{file1}` â†’ `{file2}`, `{file3}`
- `{file2}` â†’ `{file4}`

### External Dependencies

{folderName} depends on the following external modules:

- `{externalDep1}`
- `{externalDep2}`

---

## ğŸ“Š Statistics

- **Total Files**: {totalFiles}
- **Primary Language**: {primaryLanguage}
- **Architecture Layers**: {layers}

---

*This index is automatically generated by project-multilevel-index*
```

---

## ç”Ÿæˆé€»è¾‘

### æ­¥éª¤ 1: æå–æ–‡ä»¶å¤¹ä¿¡æ¯

```
function extractFolderInfo(folderPath, files):
  folderName = è·å–æ–‡ä»¶å¤¹å(folderPath)  // å¦‚ "services"

  // æ¨æ–­æ–‡ä»¶å¤¹å®šä½ (åŸºäºæ–‡ä»¶çš„ Pos)
  fileLayers = files.map(f => extractLayer(f.pos))

  // ç»Ÿè®¡æœ€å¸¸è§çš„å±‚çº§
  layerCounts = countOccurrences(fileLayers)
  mostCommonLayer = getMostCommon(layerCounts)

  folderPos = mostCommonLayer  // å¦‚ "ä¸šåŠ¡å±‚" / "Business Layer"

  // æ¨æ–­èŒè´£ (åŸºäºæ–‡ä»¶å¤¹å)
  folderResponsibility = inferResponsibility(folderName, language)
  // å¦‚ "services" â†’ "ä¸šåŠ¡é€»è¾‘" / "Business Logic"

  return {
    folderName,
    folderPos,
    folderResponsibility
  }
```

**èŒè´£æ¨æ–­**:
```
function inferResponsibility(folderName, language):
  è¯å…¸æ˜ å°„ = {
    "controllers": { zh: "æ§åˆ¶å™¨", en: "Controllers" },
    "services": { zh: "ä¸šåŠ¡é€»è¾‘", en: "Business Logic" },
    "models": { zh: "æ•°æ®æ¨¡å‹", en: "Data Models" },
    "components": { zh: "UIç»„ä»¶", en: "UI Components" },
    "utils": { zh: "å·¥å…·å‡½æ•°", en: "Utility Functions" },
    "middlewares": { zh: "ä¸­é—´ä»¶", en: "Middleware" },
    "config": { zh: "é…ç½®", en: "Configuration" },
    "tests": { zh: "æµ‹è¯•", en: "Tests" },
    ...
  }

  å¦‚æœ folderName åœ¨è¯å…¸ä¸­:
    return language == "zh-CN" ? è¯å…¸[folderName].zh : è¯å…¸[folderName].en
  å¦åˆ™:
    // é©¼å³°è½¬æ¢
    return formatFolderName(folderName)
```

---

### æ­¥éª¤ 2: ç”Ÿæˆæ–‡ä»¶åˆ—è¡¨éƒ¨åˆ†

```
function generateFileList(files, language):
  // æŒ‰æ–‡ä»¶åæ’åº
  sortedFiles = files.sort((a, b) => a.fileName.localeCompare(b.fileName))

  fileListMarkdown = []

  å¯¹æ¯ä¸ªæ–‡ä»¶:
    section = `### ${file.fileName}\n\n`
    section += `- **Input**: ${file.input.join(", ") || (language == "zh-CN" ? "æ— " : "None")}\n`
    section += `- **Output**: ${file.output.join(", ") || (language == "zh-CN" ? "æ— " : "None")}\n`
    section += `- **Pos**: ${file.pos}\n`

    fileListMarkdown.push(section)

  return fileListMarkdown.join("\n")
```

**ç¤ºä¾‹è¾“å‡º**:
```markdown
### userService.js

- **Input**: axios, ./models/User, lodash
- **Output**: UserService, createUser(), getUser()
- **Pos**: ä¸šåŠ¡å±‚-ç”¨æˆ·æœåŠ¡

### authService.js

- **Input**: jwt, bcrypt, ./models/User
- **Output**: AuthService, login(), register()
- **Pos**: ä¸šåŠ¡å±‚-è®¤è¯æœåŠ¡
```

---

### æ­¥éª¤ 3: åˆ†æä¾èµ–å…³ç³»

```
function analyzeDependencies(files, folderPath):
  internalDeps = {}   // å†…éƒ¨ä¾èµ–
  externalDeps = new Set()  // å¤–éƒ¨ä¾èµ–

  å¯¹æ¯ä¸ªæ–‡ä»¶:
    å¯¹æ¯ä¸ªä¾èµ– in file.input:
      å¦‚æœä¾èµ–æ˜¯ç›¸å¯¹è·¯å¾„:
        // è§£æä¸ºç»å¯¹è·¯å¾„
        resolvedPath = resolvePath(folderPath, file.fileName, ä¾èµ–)

        å¦‚æœ resolvedPath åœ¨åŒä¸€æ–‡ä»¶å¤¹å†…:
          // å†…éƒ¨ä¾èµ–
          å¦‚æœ internalDeps[file.fileName] ä¸å­˜åœ¨:
            internalDeps[file.fileName] = []

          targetFile = è·å–æ–‡ä»¶å(resolvedPath)
          internalDeps[file.fileName].push(targetFile)
        å¦åˆ™:
          // è·¨æ–‡ä»¶å¤¹ä¾èµ–,è§†ä¸ºå¤–éƒ¨
          externalDeps.add(ä¾èµ–)
      å¦åˆ™:
        // ç¬¬ä¸‰æ–¹ä¾èµ–
        externalDeps.add(ä¾èµ–)

  return { internalDeps, externalDeps: Array.from(externalDeps) }
```

---

### æ­¥éª¤ 4: ç”Ÿæˆä¾èµ–å…³ç³»éƒ¨åˆ†

```
function generateDependenciesSection(internalDeps, externalDeps, language):
  section = []

  // å†…éƒ¨ä¾èµ–
  if (Object.keys(internalDeps).length > 0):
    if (language == "zh-CN"):
      section.push("### å†…éƒ¨ä¾èµ–\n")
      section.push(`${folderName} å†…çš„æ–‡ä»¶ç›¸äº’ä¾èµ–:\n`)
    else:
      section.push("### Internal Dependencies\n")
      section.push(`Files within ${folderName} depend on each other:\n`)

    å¯¹æ¯ä¸ªæ–‡ä»¶ in internalDeps:
      deps = internalDeps[æ–‡ä»¶].join(", ")
      section.push(`- \`${æ–‡ä»¶}\` â†’ ${deps}`)

    section.push("")

  // å¤–éƒ¨ä¾èµ–
  if (externalDeps.length > 0):
    if (language == "zh-CN"):
      section.push("### å¤–éƒ¨ä¾èµ–\n")
      section.push(`${folderName} ä¾èµ–ä»¥ä¸‹å¤–éƒ¨æ¨¡å—:\n`)
    else:
      section.push("### External Dependencies\n")
      section.push(`${folderName} depends on the following external modules:\n`)

    // å»é‡å’Œæ’åº
    uniqueDeps = Array.from(new Set(externalDeps)).sort()

    // é™åˆ¶æ˜¾ç¤ºæ•°é‡ (é¿å…è¿‡é•¿)
    æ˜¾ç¤ºæ•°é‡ = Math.min(uniqueDeps.length, 20)

    for (i = 0; i < æ˜¾ç¤ºæ•°é‡; i++):
      section.push(`- \`${uniqueDeps[i]}\``)

    if (uniqueDeps.length > 20):
      å‰©ä½™ = uniqueDeps.length - 20
      if (language == "zh-CN"):
        section.push(`- ...(+${å‰©ä½™}é¡¹)`)
      else:
        section.push(`- ...(+${å‰©ä½™} more)`)

  return section.join("\n")
```

**ç¤ºä¾‹è¾“å‡º**:
```markdown
### å†…éƒ¨ä¾èµ–

services å†…çš„æ–‡ä»¶ç›¸äº’ä¾èµ–:

- `userService.js` â†’ `authService.js`
- `orderService.js` â†’ `userService.js`, `productService.js`

### å¤–éƒ¨ä¾èµ–

services ä¾èµ–ä»¥ä¸‹å¤–éƒ¨æ¨¡å—:

- `axios`
- `lodash`
- `./models/User`
- `./utils/validator`
```

---

### æ­¥éª¤ 5: ç”Ÿæˆç»Ÿè®¡ä¿¡æ¯éƒ¨åˆ†

```
function generateStatistics(files, language):
  totalFiles = files.length

  // ç»Ÿè®¡ä¸»è¦è¯­è¨€
  extensions = files.map(f => è·å–æ‰©å±•å(f.fileName))
  extensionCounts = countOccurrences(extensions)
  primaryExtension = getMostCommon(extensionCounts)
  primaryLanguage = mapExtensionToLanguage(primaryExtension)

  // ç»Ÿè®¡æ¶æ„å±‚çº§
  layers = files.map(f => extractLayer(f.pos))
  uniqueLayers = Array.from(new Set(layers))

  if (language == "zh-CN"):
    stats = `- **æ–‡ä»¶æ€»æ•°**: ${totalFiles}\n`
    stats += `- **ä¸»è¦è¯­è¨€**: ${primaryLanguage}\n`
    stats += `- **æ¶æ„å±‚çº§**: ${uniqueLayers.join(", ")}\n`
  else:
    stats = `- **Total Files**: ${totalFiles}\n`
    stats += `- **Primary Language**: ${primaryLanguage}\n`
    stats += `- **Architecture Layers**: ${uniqueLayers.join(", ")}\n`

  return stats
```

**è¯­è¨€æ˜ å°„**:
```
function mapExtensionToLanguage(extension):
  æ˜ å°„ = {
    ".js": "JavaScript",
    ".ts": "TypeScript",
    ".py": "Python",
    ".java": "Java",
    ".rs": "Rust",
    ".go": "Go",
    ...
  }

  return æ˜ å°„[extension] || extension
```

**ç¤ºä¾‹è¾“å‡º**:
```markdown
## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

- **æ–‡ä»¶æ€»æ•°**: 15
- **ä¸»è¦è¯­è¨€**: JavaScript
- **æ¶æ„å±‚çº§**: ä¸šåŠ¡å±‚
```

---

### æ­¥éª¤ 6: ç»„è£…å®Œæ•´ç´¢å¼•

```
function generateFolderIndex(params):
  { folderPath, files, language, LANG } = params

  // æå–æ–‡ä»¶å¤¹ä¿¡æ¯
  folderInfo = extractFolderInfo(folderPath, files)

  // åˆ†æä¾èµ–
  { internalDeps, externalDeps } = analyzeDependencies(files, folderPath)

  // ç”Ÿæˆç»Ÿè®¡
  stats = generateStatistics(files, language)

  // é€‰æ‹©æ¨¡æ¿
  template = language == "zh-CN" ? ä¸­æ–‡æ¨¡æ¿ : è‹±æ–‡æ¨¡æ¿

  // ç”Ÿæˆå„éƒ¨åˆ†
  fileListSection = generateFileList(files, language)
  depsSection = generateDependenciesSection(internalDeps, externalDeps, language)
  statsSection = stats

  // å¡«å……æ¨¡æ¿
  indexContent = template
    .replace("{folderName}", folderInfo.folderName)
    .replace("{folderPos}", folderInfo.folderPos)
    .replace("{folderResponsibility}", folderInfo.folderResponsibility)
    .replace("{fileList}", fileListSection)
    .replace("{dependencies}", depsSection)
    .replace("{statistics}", statsSection)

  return indexContent
```

---

## å®Œæ•´ç”Ÿæˆç¤ºä¾‹

### ç¤ºä¾‹è¾“å…¥

```json
{
  "folderPath": "/path/to/project/src/services",
  "files": [
    {
      "fileName": "userService.js",
      "input": ["axios", "./models/User", "lodash"],
      "output": ["UserService", "createUser()", "getUser()"],
      "pos": "ä¸šåŠ¡å±‚-ç”¨æˆ·æœåŠ¡"
    },
    {
      "fileName": "authService.js",
      "input": ["jwt", "bcrypt", "./models/User", "./userService"],
      "output": ["AuthService", "login()", "register()"],
      "pos": "ä¸šåŠ¡å±‚-è®¤è¯æœåŠ¡"
    }
  ],
  "language": "zh-CN",
  "LANG": { ... }
}
```

### ç¤ºä¾‹è¾“å‡º

```markdown
# services

ğŸ”„ **è‡ªå¼•ç”¨æé†’**: å½“æ­¤æ–‡ä»¶å¤¹å†…å®¹å˜åŒ–æ—¶,æ›´æ–°æ­¤ç´¢å¼•

## ğŸ“ æ–‡ä»¶å¤¹å®šä½

**Pos**: ä¸šåŠ¡å±‚

**èŒè´£**: ä¸šåŠ¡é€»è¾‘

---

## ğŸ“„ æ–‡ä»¶åˆ—è¡¨

### authService.js

- **Input**: jwt, bcrypt, ./models/User, ./userService
- **Output**: AuthService, login(), register()
- **Pos**: ä¸šåŠ¡å±‚-è®¤è¯æœåŠ¡

### userService.js

- **Input**: axios, ./models/User, lodash
- **Output**: UserService, createUser(), getUser()
- **Pos**: ä¸šåŠ¡å±‚-ç”¨æˆ·æœåŠ¡

---

## ğŸ”— ä¾èµ–å…³ç³»

### å†…éƒ¨ä¾èµ–

services å†…çš„æ–‡ä»¶ç›¸äº’ä¾èµ–:

- `authService.js` â†’ `userService.js`

### å¤–éƒ¨ä¾èµ–

services ä¾èµ–ä»¥ä¸‹å¤–éƒ¨æ¨¡å—:

- `./models/User`
- `axios`
- `bcrypt`
- `jwt`
- `lodash`

---

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯

- **æ–‡ä»¶æ€»æ•°**: 2
- **ä¸»è¦è¯­è¨€**: JavaScript
- **æ¶æ„å±‚çº§**: ä¸šåŠ¡å±‚

---

*æ­¤ç´¢å¼•ç”± project-multilevel-index è‡ªåŠ¨ç”Ÿæˆ*
```

---

## è¾¹ç•Œæƒ…å†µå¤„ç†

### 1. å•æ–‡ä»¶æ–‡ä»¶å¤¹

```
å¦‚æœ files.length == 1:
  è·³è¿‡å†…éƒ¨ä¾èµ–éƒ¨åˆ† (æ— æ„ä¹‰)

  ç”Ÿæˆ:
  ## ğŸ“„ æ–‡ä»¶åˆ—è¡¨

  ### {å”¯ä¸€æ–‡ä»¶}
  ...

  ## ğŸ”— ä¾èµ–å…³ç³»

  ### å¤–éƒ¨ä¾èµ–
  ...
```

---

### 2. æ— ä¾èµ–æ–‡ä»¶å¤¹

```
å¦‚æœ externalDeps.length == 0:
  ä¾èµ–å…³ç³»éƒ¨åˆ†æ˜¾ç¤º:

  ## ğŸ”— ä¾èµ–å…³ç³»

  æ­¤æ–‡ä»¶å¤¹æ— å¤–éƒ¨ä¾èµ–ã€‚
```

---

### 3. æ··åˆè¯­è¨€æ–‡ä»¶å¤¹

```
å¦‚æœæ–‡ä»¶å¤¹åŒ…å«å¤šç§è¯­è¨€:
  ä¸»è¦è¯­è¨€ = æœ€å¸¸è§çš„è¯­è¨€

  ç»Ÿè®¡ä¿¡æ¯éƒ¨åˆ†æ˜¾ç¤º:
  - **ä¸»è¦è¯­è¨€**: JavaScript (8 files), Python (3 files)
```

---

### 4. æ·±å±‚åµŒå¥—æ–‡ä»¶å¤¹

```
å¦‚æœ folderPath å¾ˆæ·±:
  folderName = ä»…æ˜¾ç¤ºæœ€åä¸€çº§æ–‡ä»¶å¤¹å

  å¦‚: /a/b/c/d/services â†’ "services"

  åœ¨æ–‡ä»¶å¤¹å®šä½éƒ¨åˆ†æ·»åŠ å®Œæ•´è·¯å¾„:
  **å®Œæ•´è·¯å¾„**: a/b/c/d/services
```

---

## æ€§èƒ½ä¼˜åŒ–

### 1. ä¾èµ–è§£æç¼“å­˜

```
pathResolveCache = {}

function resolvePath(folderPath, fileName, dependency):
  key = `${folderPath}:${fileName}:${dependency}`

  if (pathResolveCache[key]):
    return pathResolveCache[key]

  resolved = doResolve(folderPath, fileName, dependency)
  pathResolveCache[key] = resolved

  return resolved
```

### 2. æ¨¡æ¿é¢„ç¼–è¯‘

```
templateCache = {
  "zh-CN": é¢„ç¼–è¯‘ä¸­æ–‡æ¨¡æ¿,
  "en-US": é¢„ç¼–è¯‘è‹±æ–‡æ¨¡æ¿
}

function getTemplate(language):
  return templateCache[language]
```

---

## æ€»ç»“

æ–‡ä»¶å¤¹ç´¢å¼•ç”Ÿæˆå™¨ä¸ºæ¯ä¸ªæ–‡ä»¶å¤¹åˆ›å»ºç»“æ„åŒ–çš„ç´¢å¼•æ–‡æ¡£ã€‚

**å…³é”®ç‰¹æ€§**:
- âœ… åˆ—å‡ºæ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶
- âœ… æ˜¾ç¤ºæ–‡ä»¶çš„ Input/Output/Pos
- âœ… åˆ†æå†…éƒ¨å’Œå¤–éƒ¨ä¾èµ–å…³ç³»
- âœ… æä¾›ç»Ÿè®¡ä¿¡æ¯
- âœ… åµŒå…¥è‡ªå¼•ç”¨æé†’
- âœ… åŒè¯­æ”¯æŒ

**ç”Ÿæˆçš„ç´¢å¼•åŒ…å«**:
1. æ–‡ä»¶å¤¹å®šä½å’ŒèŒè´£
2. æ–‡ä»¶åˆ—è¡¨ (å«è¯¦ç»†ä¿¡æ¯)
3. ä¾èµ–å…³ç³»å›¾
4. ç»Ÿè®¡ä¿¡æ¯

**ä¸‹ä¸€æ­¥**: å‚è§ [project-index-gen.md](./project-index-gen.md) äº†è§£é¡¹ç›®ç´¢å¼•ç”Ÿæˆé€»è¾‘
